
<script>
    const trainings = [];
</script>
<div class="row align-items-center">
    <form class="mt-1 pds-form" >
        <label class=" formHeader" for="PD-EASE">Trainings</label>
        <div class="row justify-content-end">
                <button class="btn btn-primary form-btn" type="submit">Save</button>
                <button class="btn btn-danger form-btn-print disabled me-5" >Print</button>
        </div>
        <div class="row justify-content-center">
            <div class="col-lg-5 col-sm-10">

                <label class="" for="lditPrograms">Title of Learning and Development Interventions/Training Programs: </label>
                <input class="" id="lditPrograms" name="lditPrograms" placeholder="Write in full do not Abbreviate" value="" >
                
                <label class=" formsubHeader" for="spouse">Inclusive Dates of Attendance: </label>
                <label class="" for="trainedFrom">From: </label>
                <input class="" type="date" id="trainedFrom" name="trainedFrom" placeholder="Starting Date" value="" >
                <label class="" for="trainedTo">To: </label>
                <input class="" type="date" id="trainedTo" name="trainedTo" placeholder="Ending Date" value="" >

                <label class="" for="trainingnumberOfHours">Number of Hours: </label>
                <input class="" id="trainingnumberOfHours" name="trainingnumberOfHours" placeholder="in Hours" value="" >

                <label class="" for="typeOfId">Type of LD: </label>
                <select class="" id="typeOfId" name="typeOfId" value="" required>
                    <option value="Managerial">Managerial</option>
                    <option value="Supervisory">Supervisory</option>
                    <option value="Technical">Technical</option>
                </select>

                <label class="" for="conductedSponsoredBy">Conducted and Sponsored By: </label>
                <input class="" id="conductedSponsoredBy" name="conductedSponsoredBy" placeholder="Write in full " value="" >
                <a class="btn" id="AddChild" onclick="addtraining()">+ add</a>
            </div>
            <div class="col-lg-5 col-sm-10">
                <% if(tr) {if (tr.ldit === null) {} else {%><% for( var training of tr.ldit ) { %>
                    <!-- add all the current childrens to the array -->

                    <script data-trainedfrom="<%- training.trainedFrom.toDateString() %>" data-trainedto="<%- training.trainedTo.toDateString() %>" 
                        data-lditprograms="<%- training.lditPrograms %>" data-trainingnumberofhours="<%- training.trainingnumberOfHours%>"
                        data-typeofid="<%- training.typeOfId%>" data-conductedsponsoredby="<%- training.conductedSponsoredBy%>">
                        
                        trainedFrom = document.currentScript.dataset.trainedfrom;
                        trainedTo = document.currentScript.dataset.trainedto;
                        trainingnumberOfHours = document.currentScript.dataset.trainingnumberofhours;
                        typeOfId = document.currentScript.dataset.typeofid;
                        conductedSponsoredBy = document.currentScript.dataset.conductedsponsoredby;
                        lditPrograms = document.currentScript.dataset.lditprograms;

                        console.log({trainedFrom, trainedTo, trainingnumberOfHours, typeOfId, conductedSponsoredBy, lditPrograms})
                        trainings.push({trainedFrom, trainedTo, trainingnumberOfHours, typeOfId, conductedSponsoredBy, lditPrograms});
                    </script>

                <% } %><%}}%>
                <label class=" formsubHeader" for="trainings">Learning and Development Interventions/Training Programs</label>
                <div id="referenceblock1" class="referenceblock"></div>
                <input type="hidden" name="userId" id="userId" value="<%= user._id %>">
            </div>
        </div>
    </form>
    
    
</div>
<script >
    const referenceblock = document.getElementById('referenceblock1');
   
    trainings.forEach((training, index) => {
        var cardblock = document.createElement("div");
        cardblock.className = "card";
        var cardbody = document.createElement("div");
        cardbody.className = "card-body";

        // Create h1 element
        var lditProgramsblock = document.createElement("h1");
        lditProgramsblock.textContent = training.lditPrograms;
    
        // Create p element 
        var trainedFromblock = document.createElement("p");
        trainedFromblock.textContent = training.trainedFrom;
    
        // Create p element 
        var trainedToblock = document.createElement("p");
        trainedToblock.textContent = training.trainedTo;
    
        // Create p element 
        var trainingnumberOfHoursblock = document.createElement("p");
        trainingnumberOfHoursblock.textContent = training.trainingnumberOfHours;
    
        // Create p element 
        var typeOfIdblock = document.createElement("p");
        typeOfIdblock.textContent = training.typeOfId;

        // Create p element 
        var conductedSponsoredByblock = document.createElement("p");
        conductedSponsoredByblock.textContent = training.conductedSponsoredBy;
    

        // Create delete button for deleting this child's information
        var deleteButton = document.createElement("a");
        deleteButton.className = 'btn deleteButton'; // Use className to assign a class
        deleteButton.textContent = "Delete";
        
        // Add event listener to delete button
        deleteButton.addEventListener("click", function() {
            // Remove child's information and the delete button from the DOM
            referenceblock.removeChild(cardblock);
            
            // Remove child's data from the 'children' array
            trainings.splice(index);
        });
        referenceblock.appendChild(cardblock);
        cardblock.appendChild(cardbody);
    
        // Append child's name, birthday, and delete button to reference block
        cardbody.appendChild(lditProgramsblock);
        cardbody.appendChild(trainedFromblock);
        cardbody.appendChild(trainedToblock);
        cardbody.appendChild(trainingnumberOfHoursblock);
        cardbody.appendChild(typeOfIdblock);
        cardbody.appendChild(conductedSponsoredByblock);
        cardbody.appendChild(deleteButton);

    
    });
    function addtraining() {

        const lditProgramsblock = document.getElementById('lditPrograms');
        const trainedFromblock = document.getElementById('trainedFrom');
        const trainedToblock = document.getElementById('trainedTo');
        const trainingnumberOfHoursblock = document.getElementById('trainingnumberOfHours');
        const typeOfIdblock = document.getElementById('typeOfId');
        const conductedSponsoredByblock = document.getElementById('conductedSponsoredBy');
        const referenceblock = document.getElementById('referenceblock1');
       
    
        trainings.push({lditPrograms: lditPrograms.value, trainedFrom: trainedFrom.value
            , trainedTo: trainedTo.value, trainingnumberOfHours: trainingnumberOfHours.value
            , typeOfId: typeOfId.value, conductedSponsoredBy: conductedSponsoredBy.value});
            console.log(trainings, 'hello')
    
        while (referenceblock.firstChild) {
            referenceblock.removeChild(referenceblock.firstChild);
        }
    
        trainings.forEach((training, index) => {
            var cardblock = document.createElement("div");
            cardblock.className = "card";
            var cardbody = document.createElement("div");
            cardbody.className = "card-body";
    
            // Create h1 element
            var lditProgramsblock = document.createElement("h1");
            lditProgramsblock.textContent = training.lditPrograms;
        
            // Create p element 
            var trainedFromblock = document.createElement("p");
            trainedFromblock.textContent = training.trainedFrom;
        
            // Create p element 
            var trainedToblock = document.createElement("p");
            trainedToblock.textContent = training.trainedTo;
        
            // Create p element 
            var trainingnumberOfHoursblock = document.createElement("p");
            trainingnumberOfHoursblock.textContent = training.trainingnumberOfHours;
        
            // Create p element 
            var typeOfIdblock = document.createElement("p");
            typeOfIdblock.textContent = training.typeOfId;
    
            // Create p element 
            var conductedSponsoredByblock = document.createElement("p");
            conductedSponsoredByblock.textContent = training.conductedSponsoredBy;
        
    
            // Create delete button for deleting this child's information
            var deleteButton = document.createElement("a");
            deleteButton.className = 'btn deleteButton'; // Use className to assign a class
            deleteButton.textContent = "Delete";
            
            // Add event listener to delete button
            deleteButton.addEventListener("click", function() {
                // Remove child's information and the delete button from the DOM
                referenceblock.removeChild(cardblock);
                
                // Remove child's data from the 'children' array
                trainings.splice(index);
            });
            referenceblock.appendChild(cardblock);
            cardblock.appendChild(cardbody);
        
            // Append child's name, birthday, and delete button to reference block
            cardbody.appendChild(lditProgramsblock);
            cardbody.appendChild(trainedFromblock);
            cardbody.appendChild(trainedToblock);
            cardbody.appendChild(trainingnumberOfHoursblock);
            cardbody.appendChild(typeOfIdblock);
            cardbody.appendChild(conductedSponsoredByblock);
            cardbody.appendChild(deleteButton);
    
        
        });
    
    }

    const form = document.querySelector('form');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const userId = form.userId.value;
         
    
        console.log({userId, trainings} );
        try{
            const res = await fetch('/training', {
              method: 'POST',
              body: JSON.stringify({userId, ldit: trainings}),
              headers: { 'Content-Type': 'application/json' }
            });
            const data = await res.json();
                if(data.errors){
                }
                if (data.status){
                  location.assign('/training/<%=user._id%>');
                }
          }
          catch (err){
          }
      
      })
    
</script>
