<!DOCTYPE html>
<html>
<%- include('./Partials/header.ejs') %>
<body>
    <!-- navbar -->
    <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">RTU-PDSMS</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav align-right">
              <a class="nav-link active" aria-current="page" href="/">Home</a>
              <a class="nav-link" href="/dashboard">Sign Up</a>
              <a class="nav-link" href="#">Contacts</a>
              <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Login</a>
            </div>
          </div>
        </div>
      </nav>
    <!-- sign up -->
    <div class="container-fluid vh-100 p-5 balck">
        <div class="row vh-100 align-items-center d-flex p-5">
            
            <div class="col">
                    <form class="row signup-form m-5" method="POST">
                        <label for="firstname">First Name:</label>
                        <div class="firstname error"></div>
                        <input class="inputsignup" type="text" id="firstname" name="firstname" required>

                        <label for="lastname">Last Name:</label>
                        <div class="lastname error"></div>
                        <input class="inputsignup" type="text" id="lastname" name="lastname" required>

                        <label for="institutionalEmail">Institutional Email:</label>
                        <div class="institutionalEmail error"></div>
                        <input class="inputsignup" type="email" id="institutionalEmail" name="institutionalEmail" required>

                        <label for="password">Password: </label>
                        <div class="password error"></div>
                        <input class="inputsignup" type="password" id="password" name="password" required>

                        <label for="retypePassword">Re-type Password:</label>
                        <input class="inputsignup" type="password" required>

                        <div class="form-check d-flex justify-content-center mt-3">
                            <input class="form-check-input EULAcheck" type="checkbox" value="" id="flexCheckDefault">
                            <label class="form-check-label" for="flexCheckDefault">
                              I Agree to EULA Terms and Conditions
                            </label>
                        </div>
                        
                        <button type="submit">Signup</button>
                    </form>
            </div>
            <div class="col">
                <div class="row">
                    <div class="signup-info">
                        <h1 class="">Sign Up</h1>
                        <p> Lorem ipsum dolor sit amet. Ut distinctio tempore et vitae asperiores ex quibusdam culpa? Sit nihil maxime et voluptas quia ut nulla Quis? Et delectus quis aut repudiandae unde aut cumque debitis.</p>
                    </div>
                </div>  
            </div>
        </div>
    </div>
    <!-- Container-4 -->
    <div class="Container vh-100" style="padding: 30px;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;" id="contacts">
        <p>Contacts</p>
    </div>

    <script>
        const signupform = document.querySelector('form');
        const institutionalEmailError = document.querySelector('.institutionalEmail.error');
        const passwordError = document.querySelector('.password.error');
        const firstnameError = document.querySelector('.firstname.error');
        const lastnameError = document.querySelector('.lastname.error');

        signupform.addEventListener('submit', async (e) => {
          e.preventDefault();

          const firstname = signupform.firstname.value;
          const lastname = signupform.lastname.value;
          const institutionalEmail = signupform.institutionalEmail.value;
          const password = signupform.password.value;

          //reset errors 
              institutionalEmailError.textContent = '';
              passwordError.textContent = '';
              firstnameError.textContent = '';
              lastnameError.textContent = '';

          try{
            const res = await fetch('/signup', {
              method: 'POST',
              body: JSON.stringify({firstname, lastname, institutionalEmail, password}),
              headers: { 'Content-Type': 'application/json' }
            });
            const data = await res.json();
            console.log(data);
            if(data.errors){
              firstnameError.textContent = data.errors.firstname;
              lastnameError.textContent = data.errors.lastname;
              institutionalEmailError.textContent = data.errors.institutionalEmail;
              passwordError.textContent = data.errors.password;
            }
            if (data.user){
              location.assign('/');
            }
          }
          catch (err){
          }
        })
    </script>

    <%- include('./Partials/footer.ejs') %>
</body>
<%- include('./Partials/scripts.ejs') %>
</html>